"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{57300:function(e,a,c){c.d(a,{H:function(){return K}});var d,o,t,l,n,f=c(85893),b=c(9279),r=c(62922),s=c(21815),i=c(67294),x=c(67976),u=c(59813);let p="LS_EMAIL_CAPTURE",h=()=>{var e;return(null===(e=window.localStorage)||void 0===e?void 0:e.getItem(p))!==null&&JSON.parse(String(localStorage.getItem(p)))},g=()=>{var e;null===(e=window.localStorage)||void 0===e||e.setItem(p,String(!0))};var A=c(59404),C=c(77946),m=c(78904),w=c(36068),v=c(33174),y=c(41935),D=c(72755),E=c(47077);(t||(t={})).ALL_KEYS="poly_clob_api_key",(d=l||(l={})).Approved="Approved",d.Unapproved="Unapproved",(o=n||(n={})).Default="default",o.Pending="pending",o.Success="success",o.Failed="failed";let k={42:{name:"Kovan",exchange:"0xE7819d9745e64c14541732ca07CC3898670b7650",executor:"0x382E8f6a8404eB11aaFd9A5a0B11aa5A24e0830B",collateral:"0xe22da380ee6B445bb8273C81944ADEB6E8450422",conditional:""},137:{name:"Polygon",exchange:"0x6D486b31b5c0f724828Aff07c88606b213B0D196",executor:"0x6b0ab7A1E65ea6AE9072f6c45B4261ACDfB30827",collateral:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",conditional:"0x4D97DCd97eC945f40cF65F87097ACe5EA0476045"},80001:{name:"Mumbai",exchange:"0x6D486b31b5c0f724828Aff07c88606b213B0D196",executor:"0x6b0ab7A1E65ea6AE9072f6c45B4261ACDfB30827",collateral:"0x2E8DCfE708D44ae2e406a1c02DFE2Fa13012f961",conditional:"0x7D8610E9567d2a6C9FBf66a5A13E9Ba8bb120d43"}},S={outcomes:["Yes","No"]},M=e=>Object.values(e).some(e=>e===l.Approved),B=(e,a)=>new w.vU(E).encodeFunctionData("approve(address,uint256)",[e,a]),j=(e,a,c)=>({to:e,typeCode:"1",data:R(a,c),value:"0"}),F=async(e,a,c)=>{let d={};for(let o of a)if("USDC"===o.name){let t=new v.Contract(o.token,E,e);try{let n=await t.allowance(c,o.address);d[O(o)]=n.isZero()?l.Unapproved:l.Approved}catch(f){(0,y.S3)(f,"fetchAllowances ERC20 catch",c)}}else{let b=new v.Contract(o.token,D,e);try{let r=await b.isApprovedForAll(c,o.address);d[O(o)]=r?l.Approved:l.Unapproved}catch(s){(0,y.S3)(s,"fetchAllowances ERC1155 catch",c)}}return Promise.resolve(d)},O=e=>"".concat(e.type,"-").concat(e.name,"-").concat(e.address),R=(e,a)=>new w.vU(D).encodeFunctionData("setApprovalForAll(address,bool)",[e,a]),T=(e,a)=>{let c=e.outcomes.map(e=>({name:e,type:"Limit",address:k[a].exchange,token:k[a].conditional})).concat({name:"USDC",type:"Limit",address:k[a].exchange,token:k[a].collateral}),d=e.outcomes.map(e=>({name:e,type:"Market",address:k[a].executor,token:k[a].conditional})).concat({name:"USDC",type:"Market",address:k[a].executor,token:k[a].collateral});return[...c,...d]},L=["0x6b0ab7a1e65ea6ae9072f6c45b4261acdfb30827","0xd13fffd9debe07b8cf36427843f754c3f4912ff1","0xa79af3bab636f41f1f7bd1c568857dbdf4650beb","0xb77df9350b09a2c28a9094cd0e84141b428d997a","0x0364e487ccd5a61d3c83848a420846848ae08061","0xce26c779d3efe4a32c4176120de9b168064b03f5","0x807a2d05e30d6bfb643a415437d4938c7d3e1d70","0xa67209aaa09ba891adb7d291310e49914472f083","0x9eba1a4901bcc07e386a0d404f2a7a539c8a363b","0x267bba261832753f338c20091d027b4bb307d3e2","0x72dfe24820a5aa4037c7f746fd27f433e973387d","0x687349b551df31c4a330bbaf1519458cb521d9e5","0xe92c4dd69dfd711de025f4fcdd54b32772013f0d","0x44ec5e86b5717b66ceb8515f81fbc6874d784f5a","0xcd4eceab653b669338b4016ca6f3498a29f58340","0x2855eeff701562e21558d36d3dd28cbd739bafff","0x71fb1b46d13666d393a978fe45869610b7e2aee9","0x51cb8e86539c954da9c266f9d8bf1567b9145565","0xe32990bdfbaf8446280310293325228461a32b1e","0x5edd6b71bf16aea3573d754fed8f17c4a30d01d8","0x459a95b7b8e2a49b22b43e78fd5bc23992cd8ad2","0x540ae9a35a101acbfa8a0d5f9b43c5c535afa4e7","0x78f98638a1afd2dd94b3003d8d615ca219fe0dc6","0x15ae79d7cd60b2a7f06ae46eb4c7a0eb16096ffd","0xa8b7f8b34185e9cc62c471e1d353595148a3ee3c","0x495b97dcdd8e3e4ae7788ca6a53156cd4907e3fc","0xa0fbec0ffc8881c3b20aeaaec02d584d3275e939","0x8d304d67ad49597bed64895e48e021d4b33313fa","0xe9e3e01758d37e50bd8e7fe2073eecab99a5f26c","0x8330e0bd8e4666873d662db7de675cb0d93f5700","0x001ade745a6aef5eab5e543195b3be4b14549ca9","0x5da7346d021f21c415e51671a28ed8ab5a9270b5","0x296bd652f74deac6a8bd9bcb04265f3a65fd2cf2","0x56ac4f06c203d9dcfb1bc23a0ab06995de35de67","0x2e91439a0b1cead4258e3ab56030f00cce6b85aa","0x7d676a88085f3652b2e2e299cbcb529df6b3102c","0x4bbbcc24ccdddd03034902dc38790d585b6aad30","0x5d2fae355da177026bf4120804b80b61ebd1a96a","0xa42cda366758163af5fd8cbb08aed6afb1f3e87a","0xf1bb700a67e3e8a45dc8160a92f4e0405f41bf09","0x0e85cfc6d416528588c64ddcf1c6cf45e1f3f679","0x10010799404496d92058473cdbc99e6d22e174af","0x3d8a89a20aa73fba0f30d080e8120de9f9555724","0xa36f93fcd941774eb6cf03cf6a637bad282de3ce","0x8a4c788f043023b8b28a762216d037e9f148532b","0x43372356634781eea88d61bbdd7824cdce958882","0x222288bc758981b67f32e3a5f4c781c8e745cfe0","0x0593819743973d83360340fd55c538e842447a6c","0xee2d60a3bd4bdf0c50a29fcf1de256711fb87974","0x3413da83421a93ddfaa4b676ea4fd94895fa2657","0xca62d607db80661b987badf01abb499eee5afbfa","0x200544427dfc822652cb55ca5ca9f99476a9e414","0x84898b583d56054b502c6564f3edfad43b54e211","0x74cf4110993c42e35c4db5a94d3a31a7f056491e","0x6356fb47642a028bc09df92023c35a21a0b41885","0x690da21d0f2a9a4c67f59df659df07bc779ce949","0x4b180e0f8904c6cf9e1d6c56de7d9b92ac8f494e","0x76abc4deb4376bdd94f130316efe8e7483ed60f6","0xd52fc56c648b3e0ff9c025e2ebcc353039b183e7","0x7668efbca0df8195ba199d3e19cb768e8b3779ec"].reduce((e,a)=>{let c=a.toLowerCase();return e[c]||(e[c]=!0),e},{});var P=c(20402),U=c(86744),I=c(95338);let N=e=>{let{children:a,...c}=e;return(0,f.jsxs)(P.h_,{children:[(0,f.jsx)(Z,{}),(0,f.jsx)(H,{...c,children:a})]})},_=e=>{let{children:a,...c}=e;return(0,f.jsx)(P.fC,{...c,children:a})},z=e=>{let{revokeAllowancesMM:a,allowanceState:c}=e;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Y,{children:"Attention!"}),(0,f.jsx)(P.yT,{children:"We are upgrading the contracts used for the order book. Please remove allowances granted to the previous contracts before continuing."}),(0,f.jsxs)($,{css:{justifyContent:"flex-end"},children:[c===n.Pending||c===n.Default?(0,f.jsx)(I.z,{onClick:a,type:"primary",css:{cursor:"pointer"},children:c===n.Pending?"Removing...":"Remove Allowances"}):null,c===n.Success?(0,f.jsx)(I.z,{css:{color:"$polyGreen500",backgroundColor:"$polyGreen50"},children:"Success"}):null,c===n.Failed?(0,f.jsx)(I.z,{css:{color:"$polyRed500",backgroundColor:"$polyRed50"},children:"Try Again"}):null]})]})},$=(0,U.zo)("div",{display:"flex"}),Y=(0,U.zo)(P.f$,{marginTop:0,color:"$polyBlue"}),Z=(0,U.zo)(P.aV,{backgroundColor:"$shadeDarkerTransparent",position:"fixed",zIndex:5,inset:0}),H=(0,U.zo)(P.VY,{backgroundColor:"white",borderRadius:6,boxShadow:"hsl(206 22% 7% / 35%) 0px 10px 38px -10px, hsl(206 22% 7% / 20%) 0px 10px 20px -15px",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90vw",maxWidth:"500px",maxHeight:"85vh",padding:25,"&:focus":{outline:"none"},zIndex:6}),G=(0,i.createContext)({}),K=e=>{let{children:a}=e,{showEOACaptureEmailModal:c,setShowEOACaptureEmailModal:d}=(0,m.vR)(),{connector:o}=(0,x.mA)(),{authenticated:t,authenticationType:p,proxyAddress:w}=(0,C.ec)(),{sendTransaction:v}=(0,u.Z)(),[y,D]=(0,i.useState)(!1),[E,R]=(0,i.useState)({map:{},transactions:[]}),[P,U]=(0,i.useState)(n.Default),I=(0,i.useCallback)(async()=>{if(!t){console.log("loadAllowanceMap NOT AUTHENTICATED");return}if(!o){console.log("loadAllowanceMap NO CONNETOR");return}if(!w||w===b.d){console.log("loadAllowanceMap NO PROXY ADDRESS");return}let e=await (null==o?void 0:o.getSigner({chainId:137})),a=T(S,A.B8.chainId);if(e){let c=await F(e,a,w);return{map:c,allowances:a}}},[o,w,t]),$=(0,i.useCallback)(async(e,a)=>{if(!w||w===b.d){console.log("updateProxyAllowances NO PROXY ADDRESS");return}U(n.Pending);let c=e.filter(e=>{let c=O(e);return a[c]===l.Approved}),d=A.B8.chainId,o=[];for(let f of c)"USDC"===f.name?"Limit"===f.type?o.push({to:k[d].collateral,data:B("0x6D486b31b5c0f724828Aff07c88606b213B0D196",s.Zero),value:"0",typeCode:r.CallType.Call}):o.push({to:k[d].collateral,data:B("0x6b0ab7A1E65ea6AE9072f6c45B4261ACDfB30827",s.Zero),value:"0",typeCode:r.CallType.Call}):o.push(j(f.token,f.address,!1));console.log("txns.length",o.length);try{let i=await v("eoa"===p?u.i.EOA:u.i.Magic,o,0,A.Zc.Matic),x=await i.wait();if(console.log("mined",x),delete L[w.toLowerCase()],x&&t&&"eoa"===p)return U(n.Success),setTimeout(()=>{U(n.Default),D(!1)},3e3)}catch(h){if(console.log("updateProxyAllowances catch error:",h),"eoa"===p)return U(n.Failed),setTimeout(()=>{U(n.Default)},1e3)}},[w,v,p,t]),Y=(0,i.useCallback)(async()=>{try{let e=await I();if(e){let{allowances:a,map:c}=e;M(c)&&await $(a,c)}}catch(d){console.log("loadMapAndRevoke error",d)}},[I,$]),Z=(0,i.useCallback)(async()=>{try{let e=await I();e&&e.map&&M(e.map)&&(D(!0),R({map:e.map,transactions:e.allowances}))}catch(a){console.log("loadMapForMM error",a)}},[I]),H=(0,i.useCallback)(async()=>{try{let{map:e,transactions:a}=E,c=Object.keys(e);c.length&&E&&await $(a,e)}catch(d){return console.log("revokeAllowancesMM error",d),U(n.Failed),setTimeout(()=>{U(n.Default)},1e3)}},[E,$]);(0,i.useEffect)(()=>{let e=L[(null!=w?w:b.d).toLowerCase()];A.Mw||console.log("isUserOnList:",e),t&&w&&e&&("magic"===p&&(A.Mw||console.log("userIsOnMagicList"),Y()),"eoa"!==p||h()||(A.Mw||console.log("in hasDisabledEmailCapture"),g()),"eoa"===p&&c&&(A.Mw||console.log("in showEOACaptureEmailModal"),d(!1)),"eoa"===p&&(A.Mw||console.log("userIsOnMetaMaskList"),Z()))},[I,w,Y,Z,d,c,t,p]);let K=(0,i.useMemo)(()=>({revokeAllowancesMM:H}),[H]);return(0,f.jsxs)(G.Provider,{value:K,children:[a,(0,f.jsx)(_,{open:y,children:(0,f.jsx)(N,{children:(0,f.jsx)(z,{revokeAllowancesMM:H,allowanceState:P})})})]})}}}]);